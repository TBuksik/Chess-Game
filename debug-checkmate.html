<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Checkmate</title>
</head>
<body>
    <h1>Debug Checkmate Detection</h1>
    <div id="debug-output"></div>
    
    <script src="js/utils.js"></script>
    <script src="js/pieces.js"></script>
    <script>
        // Create a foolsmate scenario (simplest checkmate in chess)
        const board = Array(8).fill().map(() => Array(8).fill(null));
        
        // Set up fools mate position
        board[7][4] = new ChessPiece('king', 'white', 7, 4);     // White king on e1
        board[6][5] = new ChessPiece('pawn', 'white', 6, 5);    // White pawn on f2
        board[5][6] = new ChessPiece('pawn', 'white', 5, 6);    // White pawn on g3
        board[0][4] = new ChessPiece('king', 'black', 0, 4);     // Black king on e8
        board[3][7] = new ChessPiece('queen', 'black', 3, 7);    // Black queen on h5 giving checkmate
        
        console.log('Testing fools mate with real chess pieces');
        console.log('Board setup:');
        console.log('- White king at (7,4) - e1');
        console.log('- White pawn at (6,5) - f2');
        console.log('- White pawn at (5,6) - g3');
        console.log('- Black king at (0,4) - e8');
        console.log('- Black queen at (3,7) - h5');
        
        // Test if white king is in check
        const isInCheck = MoveValidator.isKingInCheck(board, 'white');
        console.log('Is white king in check?', isInCheck);
        
        // Debug: What moves can the black queen make?
        const blackQueen = board[3][7];
        const queenMoves = blackQueen.getValidMoves(board);
        console.log('Black queen moves:', queenMoves);
        console.log('Can black queen attack (7,4)?', queenMoves.some(([r, c]) => r === 7 && c === 4));
        
        // Test checkmate
        const isCheckmate = MoveValidator.isCheckmate(board, 'white');
        console.log('Is it checkmate?', isCheckmate);
        
        // Debug moves
        const whiteKing = board[7][4];
        const kingMoves = whiteKing.getValidMoves(board);
        console.log('White king possible moves:', kingMoves);
        
        for (let [toRow, toCol] of kingMoves) {
            console.log(`\nTesting move to (${toRow},${toCol})`);
            const testBoard = MoveValidator.simulateMove(board, 7, 4, toRow, toCol);
            console.log('After move, white king would be at:', `(${toRow},${toCol})`);
            
            // Check if any black piece can attack this position
            let attackedBy = [];
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const piece = testBoard[row][col];
                    if (piece && piece.color === 'black') {
                        const moves = piece.getValidMoves(testBoard);
                        if (moves.some(([r, c]) => r === toRow && c === toCol)) {
                            attackedBy.push(`${piece.type} at (${row},${col})`);
                        }
                    }
                }
            }
            
            const stillInCheck = MoveValidator.isKingInCheck(testBoard, 'white');
            console.log(`  Still in check after move: ${stillInCheck}`);
            console.log(`  Attacked by: ${attackedBy.join(', ') || 'none'}`);
        }
        
        // Output results to page
        const debugOutput = document.getElementById('debug-output');
        debugOutput.innerHTML = `
            <p>Is in check: ${isInCheck}</p>
            <p>Is checkmate: ${isCheckmate}</p>
            <p>King moves: ${JSON.stringify(kingMoves)}</p>
            <p>Check console for detailed debug info</p>
        `;
    </script>
</body>
</html>

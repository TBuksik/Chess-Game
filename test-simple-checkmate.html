<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Game Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-board {
            display: grid;
            grid-template-columns: repeat(8, 30px);
            grid-template-rows: repeat(8, 30px);
            gap: 1px;
            background: #333;
            margin: 10px 0;
        }
        .test-square {
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        .test-square.dark {
            background: #888;
        }
    </style>
</head>
<body>
    <h1>Chess Game Checkmate Test</h1>
    <div id="test-results"></div>
    
    <script>
        // Simple test without loading external files
        function runSimpleTests() {
            const resultsDiv = document.getElementById('test-results');
            
            // Test 1: Simple checkmate logic
            function testSimpleCheckmate() {
                console.log('Testing simple checkmate logic...');
                
                // Simulate a simple checkmate scenario
                // King in corner, queen controls escape squares
                const board = Array(8).fill().map(() => Array(8).fill(null));
                
                const blackKing = { type: 'king', color: 'black', row: 0, col: 0 };
                const whiteQueen = { type: 'queen', color: 'white', row: 1, col: 1 };
                const whiteKing = { type: 'king', color: 'white', row: 2, col: 2 };
                
                board[0][0] = blackKing;
                board[1][1] = whiteQueen;
                board[2][2] = whiteKing;
                
                // Check if king is in check
                function isKingInCheck(board, color) {
                    const king = findKing(board, color);
                    if (!king) return false;
                    
                    const oppositeColor = color === 'white' ? 'black' : 'white';
                    
                    for (let row = 0; row < 8; row++) {
                        for (let col = 0; col < 8; col++) {
                            const piece = board[row][col];
                            if (piece && piece.color === oppositeColor) {
                                const moves = getValidMoves(piece, board);
                                if (moves.some(([r, c]) => r === king.row && c === king.col)) {
                                    return true;
                                }
                            }
                        }
                    }
                    return false;
                }
                
                function findKing(board, color) {
                    for (let row = 0; row < 8; row++) {
                        for (let col = 0; col < 8; col++) {
                            const piece = board[row][col];
                            if (piece && piece.type === 'king' && piece.color === color) {
                                return piece;
                            }
                        }
                    }
                    return null;
                }
                
                function getValidMoves(piece, board) {
                    const moves = [];
                    
                    if (piece.type === 'king') {
                        const directions = [
                            [-1, -1], [-1, 0], [-1, 1],
                            [0, -1],           [0, 1],
                            [1, -1],  [1, 0],  [1, 1]
                        ];
                        
                        for (let [rowOffset, colOffset] of directions) {
                            const newRow = piece.row + rowOffset;
                            const newCol = piece.col + colOffset;
                            
                            if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8) {
                                const target = board[newRow][newCol];
                                if (!target || target.color !== piece.color) {
                                    moves.push([newRow, newCol]);
                                }
                            }
                        }
                    } else if (piece.type === 'queen') {
                        const directions = [
                            [-1, -1], [-1, 0], [-1, 1],
                            [0, -1],           [0, 1],
                            [1, -1],  [1, 0],  [1, 1]
                        ];
                        
                        for (let [rowDir, colDir] of directions) {
                            for (let i = 1; i < 8; i++) {
                                const newRow = piece.row + rowDir * i;
                                const newCol = piece.col + colDir * i;
                                
                                if (newRow < 0 || newRow >= 8 || newCol < 0 || newCol >= 8) break;
                                
                                const target = board[newRow][newCol];
                                if (!target) {
                                    moves.push([newRow, newCol]);
                                } else {
                                    if (target.color !== piece.color) {
                                        moves.push([newRow, newCol]);
                                    }
                                    break;
                                }
                            }
                        }
                    }
                    
                    return moves;
                }
                
                function simulateMove(board, fromRow, fromCol, toRow, toCol) {
                    const newBoard = board.map(row => [...row]);
                    const piece = newBoard[fromRow][fromCol];
                    
                    if (piece) {
                        newBoard[toRow][toCol] = { ...piece, row: toRow, col: toCol };
                        newBoard[fromRow][fromCol] = null;
                    }
                    
                    return newBoard;
                }
                
                function isCheckmate(board, color) {
                    if (!isKingInCheck(board, color)) {
                        return false;
                    }
                    
                    // Check if any move can get out of check
                    for (let row = 0; row < 8; row++) {
                        for (let col = 0; col < 8; col++) {
                            const piece = board[row][col];
                            if (piece && piece.color === color) {
                                const moves = getValidMoves(piece, board);
                                for (let [toRow, toCol] of moves) {
                                    const testBoard = simulateMove(board, row, col, toRow, toCol);
                                    if (!isKingInCheck(testBoard, color)) {
                                        console.log(`Found escape move: ${piece.type} from (${row},${col}) to (${toRow},${toCol})`);
                                        return false;
                                    }
                                }
                            }
                        }
                    }
                    
                    return true;
                }
                
                // Test the logic
                const inCheck = isKingInCheck(board, 'black');
                const checkmate = isCheckmate(board, 'black');
                
                console.log('Simple test results:', { inCheck, checkmate });
                console.log('Black king moves:', getValidMoves(blackKing, board));
                console.log('White queen moves:', getValidMoves(whiteQueen, board));
                
                // Test each king move
                const kingMoves = getValidMoves(blackKing, board);
                for (let [toRow, toCol] of kingMoves) {
                    const testBoard = simulateMove(board, 0, 0, toRow, toCol);
                    const stillInCheck = isKingInCheck(testBoard, 'black');
                    console.log(`King move to (${toRow},${toCol}): still in check = ${stillInCheck}`);
                }
                
                return inCheck && checkmate;
            }
            
            // Run the test
            try {
                const result = testSimpleCheckmate();
                const div = document.createElement('div');
                div.className = `test-result ${result ? 'pass' : 'fail'}`;
                div.textContent = `Simple checkmate test: ${result ? 'PASS' : 'FAIL'}`;
                resultsDiv.appendChild(div);
            } catch (error) {
                console.error('Test error:', error);
                const div = document.createElement('div');
                div.className = 'test-result fail';
                div.textContent = `Simple checkmate test: ERROR - ${error.message}`;
                resultsDiv.appendChild(div);
            }
        }
        
        // Run tests when page loads
        window.onload = runSimpleTests;
    </script>
</body>
</html>
